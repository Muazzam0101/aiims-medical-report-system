<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>AI Medical Assistant | AIIMS System</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <script id="tailwind-config">
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "primary": "#1E3A8A", // Sidebar background
                        "secondary-blue": "#3B82F6", // User bubble
                        "accent-green": "#10B981", // Active indicator
                        "background-light": "#F8FAFC",
                        "card-bg": "#FFFFFF",
                        "border-color": "#E5E7EB",
                        "text-primary": "#1F2937",
                        "text-secondary": "#6B7280",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .sidebar-height {
            height: 100vh;
        }

        .chat-scroll {
            height: calc(100vh - 420px);
            overflow-y: auto;
        }

        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>

<body class="bg-background-light text-text-primary flex font-display">
    <!-- Fixed Left Sidebar -->
    <aside
        class="w-[260px] bg-white sidebar-height fixed left-0 top-0 flex flex-col text-slate-900 border-r border-slate-200 z-50">
        <div class="p-6 flex items-center gap-3">
            <div class="w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center text-primary">
                <span class="material-symbols-outlined text-2xl">medical_services</span>
            </div>
            <div>
                <h1 class="text-sm font-bold leading-tight uppercase tracking-tight text-slate-900">AIIMS MEDICAL</h1>
                <p class="text-[10px] text-slate-500 uppercase tracking-widest">Simplification System</p>
            </div>
        </div>
        <nav class="flex-1 mt-4 px-3 space-y-1">
            <a class="flex items-center gap-3 px-4 py-3 rounded-lg text-slate-600 hover:bg-slate-50 transition-colors group"
                href="dashboard.html">
                <span
                    class="material-symbols-outlined text-slate-400 group-hover:text-primary transition-colors text-xl">dashboard</span>
                <span class="text-sm font-medium">Dashboard</span>
            </a>
            <a class="flex items-center gap-3 px-4 py-3 rounded-lg text-slate-600 hover:bg-slate-50 transition-colors group"
                href="upload.html">
                <span
                    class="material-symbols-outlined text-slate-400 group-hover:text-primary transition-colors text-xl">upload_file</span>
                <span class="text-sm font-medium">Upload Report</span>
            </a>
            <a class="flex items-center gap-3 px-4 py-3 rounded-lg text-slate-600 hover:bg-slate-50 transition-colors group"
                href="report-history.html">
                <span
                    class="material-symbols-outlined text-slate-400 group-hover:text-primary transition-colors text-xl">history</span>
                <span class="text-sm font-medium">Report History</span>
            </a>
            <a class="flex items-center gap-3 px-4 py-3 rounded-lg text-slate-600 hover:bg-slate-50 transition-colors group"
                href="blood-group.html">
                <span
                    class="material-symbols-outlined text-slate-400 group-hover:text-primary transition-colors text-xl">bloodtype</span>
                <span class="text-sm font-medium">Blood Group Detection</span>
            </a>
            <a class="flex items-center gap-3 px-4 py-3 rounded-lg bg-primary/5 text-primary border-r-4 border-primary relative"
                href="chatbot.html">
                <span class="material-symbols-outlined text-xl">smart_toy</span>
                <span class="text-sm font-bold">AI Medical Assistant</span>
                <div class="absolute right-3 w-1.5 h-6 bg-primary rounded-full"></div>
            </a>
            <a class="flex items-center gap-3 px-4 py-3 rounded-lg text-slate-600 hover:bg-slate-50 transition-colors group"
                href="settings.html">
                <span
                    class="material-symbols-outlined text-slate-400 group-hover:text-primary transition-colors text-xl">settings</span>
                <span class="text-sm font-medium">Settings</span>
            </a>
        </nav>
        <div class="p-6 border-t border-slate-100">
            <div class="flex items-center gap-3">
                <div
                    class="size-9 rounded-full bg-primary/10 flex items-center justify-center text-primary font-bold text-xs">
                    JD</div>
                <div class="overflow-hidden">
                    <p class="text-xs font-semibold truncate text-slate-900">Dr. John Doe</p>
                    <p class="text-[10px] text-slate-500 truncate">Medical Practitioner</p>
                </div>
            </div>
        </div>
    </aside>
    <!-- Main Content Area -->
    <main class="flex-1 ml-[260px] p-8 min-h-screen">
        <!-- Page Header -->
        <header class="mb-8 max-w-[800px] mx-auto">
            <h2 class="text-3xl font-bold text-text-primary tracking-tight">AI Medical Assistant</h2>
            <p class="text-text-secondary mt-1 text-lg">Ask health-related questions and receive simplified
                explanations.</p>
        </header>
        <!-- Disclaimer Banner -->
        <div
            class="max-w-[800px] mx-auto mb-8 bg-card-bg border-l-4 border-accent-green shadow-sm rounded-lg p-5 flex items-start gap-4">
            <span class="material-symbols-outlined text-accent-green">info</span>
            <div>
                <p class="text-text-primary font-semibold text-sm">Medical Disclaimer</p>
                <p class="text-text-secondary text-sm leading-relaxed mt-0.5">
                    This assistant provides general educational information and does not replace professional medical
                    consultation. Please consult a qualified doctor for any serious health concerns.
                </p>
            </div>
        </div>
        <!-- Chat Container -->
        <div
            class="max-w-[800px] mx-auto bg-card-bg rounded-xl shadow-md border border-border-color flex flex-col relative overflow-hidden">
            <!-- Chat Header -->
            <div
                class="px-6 py-4 border-b border-border-color flex items-center justify-between bg-white sticky top-0 z-10">
                <div class="flex items-center gap-3">
                    <div
                        class="size-10 rounded-full bg-primary/5 flex items-center justify-center border border-primary/10">
                        <span class="material-symbols-outlined text-primary">smart_toy</span>
                    </div>
                    <div>
                        <h3 class="text-sm font-bold text-text-primary">AIIMS Bot</h3>
                        <div class="flex items-center gap-1.5">
                            <span class="size-2 rounded-full bg-accent-green"></span>
                            <span
                                class="text-[11px] font-medium text-text-secondary uppercase tracking-wider">Online</span>
                        </div>
                    </div>
                </div>
                <button class="text-text-secondary hover:text-text-primary transition-colors">
                    <span class="material-symbols-outlined">more_vert</span>
                </button>
            </div>
            <!-- Chat Messages Area -->
            <div id="chat-messages" class="chat-scroll px-6 py-8 space-y-8">
                <!-- Bot Message -->
                <div class="flex gap-3 max-w-[85%]">
                    <div class="flex-shrink-0 size-8 rounded-full bg-primary/10 flex items-center justify-center">
                        <span class="material-symbols-outlined text-primary text-sm">smart_toy</span>
                    </div>
                    <div>
                        <div
                            class="bg-secondary-blue/5 border border-secondary-blue/10 text-text-primary px-4 py-3 rounded-2xl rounded-tl-none">
                            <p class="text-sm leading-relaxed">Hello! I am your AIIMS Medical Assistant. How can I help
                                you understand your reports or medical terms today?</p>
                        </div>
                        <span class="text-[10px] text-text-secondary mt-1.5 block ml-1">Today</span>
                    </div>
                </div>
            </div>
            <!-- Chat Footer Section -->
            <div class="p-6 border-t border-border-color bg-white">
                <!-- Quick Suggestion Chips -->
                <div class="flex flex-wrap gap-2 mb-4">
                    <button
                        class="px-4 py-1.5 rounded-full border border-border-color text-xs font-medium text-text-secondary hover:bg-slate-50 hover:text-primary hover:border-primary transition-all">
                        What does high blood sugar mean?
                    </button>
                    <button
                        class="px-4 py-1.5 rounded-full border border-border-color text-xs font-medium text-text-secondary hover:bg-slate-50 hover:text-primary hover:border-primary transition-all">
                        Explain hemoglobin levels.
                    </button>
                    <button
                        class="px-4 py-1.5 rounded-full border border-border-color text-xs font-medium text-text-secondary hover:bg-slate-50 hover:text-primary hover:border-primary transition-all">
                        What is cholesterol?
                    </button>
                    <button
                        class="px-4 py-1.5 rounded-full border border-border-color text-xs font-medium text-text-secondary hover:bg-slate-50 hover:text-primary hover:border-primary transition-all">
                        What is blood pressure?
                    </button>
                </div>
                <!-- Chat Input Area -->
                <div class="relative flex items-center gap-2">
                    <div class="relative flex-1">
                        <input id="user-input"
                            class="w-full bg-background-light border border-border-color rounded-lg px-4 py-3 text-sm focus:ring-2 focus:ring-secondary-blue/20 focus:border-secondary-blue transition-all outline-none pr-10"
                            placeholder="Type your medical question..." type="text" />
                        <button
                            class="absolute right-3 top-1/2 -translate-y-1/2 text-text-secondary hover:text-secondary-blue">
                            <span class="material-symbols-outlined text-xl">attach_file</span>
                        </button>
                    </div>
                    <button id="send-button"
                        class="bg-accent-green hover:bg-emerald-600 text-white size-11 rounded-lg flex items-center justify-center transition-all shadow-lg shadow-accent-green/20 group">
                        <span
                            class="material-symbols-outlined group-hover:translate-x-0.5 transition-transform">send</span>
                    </button>
                </div>
            </div>
        </div>
        <!-- System Footer Info -->
        <footer class="max-w-[800px] mx-auto mt-6 text-center">
            <p class="text-[11px] text-text-secondary uppercase tracking-widest font-medium">Powered by AIIMS Research
                Intelligence Module</p>
        </footer>
    </main>

    <script>
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const apiEndpoint = 'http://172.18.4.144:8000/chat';

        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function appendMessage(text, isBot = true) {
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const messageDiv = document.createElement('div');

            if (isBot) {
                messageDiv.className = 'flex gap-3 max-w-[85%] fade-in';
                messageDiv.innerHTML = `
                    <div class="flex-shrink-0 size-8 rounded-full bg-primary/10 flex items-center justify-center">
                        <span class="material-symbols-outlined text-primary text-sm">smart_toy</span>
                    </div>
                    <div>
                        <div class="bg-secondary-blue/5 border border-secondary-blue/10 text-text-primary px-4 py-3 rounded-2xl rounded-tl-none">
                            <div class="text-sm leading-relaxed">${text}</div>
                        </div>
                        <span class="text-[10px] text-text-secondary mt-1.5 block ml-1">${time}</span>
                    </div>
                `;
            } else {
                messageDiv.className = 'flex flex-row-reverse gap-3 ml-auto max-w-[85%] fade-in';
                messageDiv.innerHTML = `
                    <div class="flex-shrink-0 size-8 rounded-full bg-secondary-blue/10 flex items-center justify-center">
                        <span class="material-symbols-outlined text-secondary-blue text-sm">person</span>
                    </div>
                    <div class="text-right">
                        <div class="bg-secondary-blue text-white px-4 py-3 rounded-2xl rounded-tr-none shadow-sm shadow-secondary-blue/20">
                            <p class="text-sm leading-relaxed">${text}</p>
                        </div>
                        <span class="text-[10px] text-text-secondary mt-1.5 block mr-1">${time}</span>
                    </div>
                `;
            }
            chatMessages.appendChild(messageDiv);
            scrollToBottom();
        }

        let typingIndicator = null;

        function showTypingIndicator() {
            if (typingIndicator) return;
            typingIndicator = document.createElement('div');
            typingIndicator.className = 'flex gap-3 max-w-[85%] animate-pulse';
            typingIndicator.innerHTML = `
                <div class="flex-shrink-0 size-8 rounded-full bg-primary/10 flex items-center justify-center">
                    <span class="material-symbols-outlined text-primary text-sm">smart_toy</span>
                </div>
                <div>
                    <div class="bg-slate-100 px-4 py-2 rounded-2xl rounded-tl-none italic text-xs text-text-secondary">
                        AI is typing...
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingIndicator);
            scrollToBottom();
        }

        function hideTypingIndicator() {
            if (typingIndicator) {
                typingIndicator.remove();
                typingIndicator = null;
            }
        }

        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;

            // Clear input and disable
            userInput.value = '';
            userInput.disabled = true;
            sendButton.disabled = true;
            sendButton.classList.add('opacity-50', 'cursor-not-allowed');

            appendMessage(message, false);
            showTypingIndicator();

            try {
                const response = await fetch(apiEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message: message })
                });

                const data = await response.json();
                hideTypingIndicator();

                if (!response.ok) {
                    appendMessage(`Server error: ${data.detail || response.status}`);
                } else {
                    appendMessage(data.response || 'I received an empty response.');
                    if (data.disclaimer) {
                        appendMessage(`<small class="text-text-secondary italic">${data.disclaimer}</small>`);
                    }
                }

            } catch (error) {
                console.error('Chatbot Error:', error);
                hideTypingIndicator();
                appendMessage(`Connection error. Please ensure the backend server at 172.18.4.144 is running and accessible.`);
            } finally {
                userInput.disabled = false;
                sendButton.disabled = false;
                sendButton.classList.remove('opacity-50', 'cursor-not-allowed');
                userInput.focus();
            }
        }

        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        // Suggestion chips logic
        document.querySelectorAll('button[class*="rounded-full border"]').forEach(chip => {
            chip.addEventListener('click', () => {
                userInput.value = chip.innerText;
                sendMessage();
            });
        });

        // Initialize scroll
        scrollToBottom();
    </script>
</body>

</html>